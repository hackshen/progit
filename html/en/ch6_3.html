<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Stashing - Git Tools - Pro Git</title><link rel="stylesheet" type="text/css" href="../../assets/vendor/bootstrap/dist/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="../../assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" type="text/css" href="../../assets/vendor/nprogress/nprogress.css"><link rel="stylesheet" type="text/css" href="../../assets/css/main.css"><link rel="shortcut icon" type="images/x-icon" href="../../assets/img/favicon.ico"></head><body><a href="#main" class="sr-only">SKIP TO CONTENT</a><div id="pjax-container"><div id="header" class="navbar navbar-fixed-top navbar-inverse"><div class="container"><div class="navbar-header"><a id="brand" href="/progit/"><img src="../../assets/img/git-logo.png" alt="git" class="logo"></a><button type="button" data-toggle="collapse" data-target=".navigation" class="navbar-toggle"><span class="sr-only">Toggle Navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="navbar-collapse collapse navigation"><ul class="nav navbar-nav"><li class="dropdown"><a data-toggle="dropdown" href="#" class="dropdown-toggle"><span class="octicon octicon-list-unordered"></span> Table Of Contents<b class="caret"></b></a><ul role="menu" class="dropdown-menu menu-toc"><li class="menu-toc-chapter"><a href="ch1_0.html">1   Getting Started </a><ul class="menu-section-links"><li><a href="ch1_1.html">1.1   About Version Control </a></li><li><a href="ch1_2.html">1.2   A Short History of Git </a></li><li><a href="ch1_3.html">1.3   Git Basics </a></li><li><a href="ch1_4.html">1.4   Installing Git </a></li><li><a href="ch1_5.html">1.5   First-Time Git Setup </a></li><li><a href="ch1_6.html">1.6   Getting Help </a></li><li><a href="ch1_7.html">1.7   Summary </a></li></ul></li><li class="menu-toc-chapter"><a href="ch2_0.html">2   Git Basics </a><ul class="menu-section-links"><li><a href="ch2_1.html">2.1   Getting a Git Repository </a></li><li><a href="ch2_2.html">2.2   Recording Changes to the Repository </a></li><li><a href="ch2_3.html">2.3   Viewing the Commit History </a></li><li><a href="ch2_4.html">2.4   Undoing Things </a></li><li><a href="ch2_5.html">2.5   Working with Remotes </a></li><li><a href="ch2_6.html">2.6   Tagging </a></li><li><a href="ch2_7.html">2.7   Tips and Tricks </a></li><li><a href="ch2_8.html">2.8   Summary </a></li></ul></li><li class="menu-toc-chapter"><a href="ch3_0.html">3   Git Branching </a><ul class="menu-section-links"><li><a href="ch3_1.html">3.1   What a Branch Is </a></li><li><a href="ch3_2.html">3.2   Basic Branching and Merging </a></li><li><a href="ch3_3.html">3.3   Branch Management </a></li><li><a href="ch3_4.html">3.4   Branching Workflows </a></li><li><a href="ch3_5.html">3.5   Remote Branches </a></li><li><a href="ch3_6.html">3.6   Rebasing </a></li><li><a href="ch3_7.html">3.7   Summary </a></li></ul></li><li class="menu-toc-chapter"><a href="ch4_0.html">4   Git on the Server </a><ul class="menu-section-links"><li><a href="ch4_1.html">4.1   The Protocols </a></li><li><a href="ch4_2.html">4.2   Getting Git on a Server </a></li><li><a href="ch4_3.html">4.3   Generating Your SSH Public Key </a></li><li><a href="ch4_4.html">4.4   Setting Up the Server </a></li><li><a href="ch4_5.html">4.5   Public Access </a></li><li><a href="ch4_6.html">4.6   GitWeb </a></li><li><a href="ch4_7.html">4.7   Gitosis </a></li><li><a href="ch4_8.html">4.8   Gitolite </a></li><li><a href="ch4_9.html">4.9   Git Daemon </a></li><li><a href="ch4_10.html">4.10   Hosted Git </a></li><li><a href="ch4_11.html">4.11   Summary </a></li></ul></li><li class="menu-toc-chapter"><a href="ch5_0.html">5   Distributed Git </a><ul class="menu-section-links"><li><a href="ch5_1.html">5.1   Distributed Workflows </a></li><li><a href="ch5_2.html">5.2   Contributing to a Project </a></li><li><a href="ch5_3.html">5.3   Maintaining a Project </a></li><li><a href="ch5_4.html">5.4   Summary </a></li></ul></li><li class="menu-toc-chapter"><a href="ch6_0.html">6   Git Tools </a><ul class="menu-section-links"><li><a href="ch6_1.html">6.1   Revision Selection </a></li><li><a href="ch6_2.html">6.2   Interactive Staging </a></li><li><a href="ch6_3.html">6.3   Stashing </a></li><li><a href="ch6_4.html">6.4   Rewriting History </a></li><li><a href="ch6_5.html">6.5   Debugging with Git </a></li><li><a href="ch6_6.html">6.6   Submodules </a></li><li><a href="ch6_7.html">6.7   Subtree Merging </a></li><li><a href="ch6_8.html">6.8   Summary </a></li></ul></li><li class="menu-toc-chapter"><a href="ch7_0.html">7   Customizing Git </a><ul class="menu-section-links"><li><a href="ch7_1.html">7.1   Git Configuration </a></li><li><a href="ch7_2.html">7.2   Git Attributes </a></li><li><a href="ch7_3.html">7.3   Git Hooks </a></li><li><a href="ch7_4.html">7.4   An Example Git-Enforced Policy </a></li><li><a href="ch7_5.html">7.5   Summary </a></li></ul></li><li class="menu-toc-chapter"><a href="ch8_0.html">8   Git and Other Systems </a><ul class="menu-section-links"><li><a href="ch8_1.html">8.1   Git and Subversion </a></li><li><a href="ch8_2.html">8.2   Migrating to Git </a></li><li><a href="ch8_3.html">8.3   Summary </a></li></ul></li><li class="menu-toc-chapter"><a href="ch9_0.html">9   Git Internals </a><ul class="menu-section-links"><li><a href="ch9_1.html">9.1   Plumbing and Porcelain </a></li><li><a href="ch9_2.html">9.2   Git Objects </a></li><li><a href="ch9_3.html">9.3   Git References </a></li><li><a href="ch9_4.html">9.4   Packfiles </a></li><li><a href="ch9_5.html">9.5   The Refspec </a></li><li><a href="ch9_6.html">9.6   Transfer Protocols </a></li><li><a href="ch9_7.html">9.7   Maintenance and Data Recovery </a></li><li><a href="ch9_8.html">9.8   Summary </a></li></ul></li></ul></li></ul><ul class="nav navbar-nav navbar-right"><li class="dropdown"><a data-toggle="dropdown" href="#" class="dropdown-toggle"><span class="octicon octicon-globe"></span> Other Translations<b class="caret"></b></a><ul role="menu" class="dropdown-menu"><li><a href="../../index.en.html">English</a></li><li><a href="../../index.html">简体中文</a></li><li><a href="../../index.zh-tw.html">正體中文</a></li></ul></li><li><a href="../../about.html"><span class="octicon octicon-question"></span> About</a></li></ul></div></div></div><div id="main" class="container"><div class="row wrap"><div class="col-md-4"><div class="ph20"> <ul class="nav sub-nav"><li class="nav-header"><a href="ch6_0.html">Git Tools</a></li><li><a href="ch6_1.html">Revision Selection</a></li><li><a href="ch6_2.html">Interactive Staging</a></li><li><a href="ch6_3.html">Stashing</a></li><li><a href="ch6_4.html">Rewriting History</a></li><li><a href="ch6_5.html">Debugging with Git</a></li><li><a href="ch6_6.html">Submodules</a></li><li><a href="ch6_7.html">Subtree Merging</a></li><li><a href="ch6_8.html">Summary</a></li></ul></div></div><div class="col-md-8"><div class="ph20"><h2>Stashing</h2>

<p>Often, when you’ve been working on part of your project, things are in a messy state and you want to switch branches for a bit to work on something else. The problem is, you don’t want to do a commit of half-done work just so you can get back to this point later. The answer to this issue is the <code>git stash</code> command.</p>

<p>Stashing takes the dirty state of your working directory — that is, your modified tracked files and staged changes — and saves it on a stack of unfinished changes that you can reapply at any time.</p>

<h3>Stashing Your Work</h3>

<p>To demonstrate, you’ll go into your project and start working on a couple of files and possibly stage one of the changes. If you run <code>git status</code>, you can see your dirty state:</p>

<pre><code>$ git status
# On branch master
# Changes to be committed:
#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)
#
#      modified:   index.html
#
# Changes not staged for commit:
#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
#
#      modified:   lib/simplegit.rb
#</code></pre>

<p>Now you want to switch branches, but you don’t want to commit what you’ve been working on yet; so you’ll stash the changes. To push a new stash onto your stack, run <code>git stash</code>:</p>

<pre><code>$ git stash
Saved working directory and index state \
  &quot;WIP on master: 049d078 added the index file&quot;
HEAD is now at 049d078 added the index file
(To restore them type &quot;git stash apply&quot;)</code></pre>

<p>Your working directory is clean:</p>

<pre><code>$ git status
# On branch master
nothing to commit, working directory clean</code></pre>

<p>At this point, you can easily switch branches and do work elsewhere; your changes are stored on your stack. To see which stashes you’ve stored, you can use <code>git stash list</code>:</p>

<pre><code>$ git stash list
stash@{0}: WIP on master: 049d078 added the index file
stash@{1}: WIP on master: c264051 Revert &quot;added file_size&quot;
stash@{2}: WIP on master: 21d80a5 added number to log</code></pre>

<p>In this case, two stashes were done previously, so you have access to three different stashed works. You can reapply the one you just stashed by using the command shown in the help output of the original stash command: <code>git stash apply</code>. If you want to apply one of the older stashes, you can specify it by naming it, like this: <code>git stash apply stash@{2}</code>. If you don’t specify a stash, Git assumes the most recent stash and tries to apply it:</p>

<pre><code>$ git stash apply
# On branch master
# Changes not staged for commit:
#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
#
#      modified:   index.html
#      modified:   lib/simplegit.rb
#</code></pre>

<p>You can see that Git re-modifies the files you uncommitted when you saved the stash. In this case, you had a clean working directory when you tried to apply the stash, and you tried to apply it on the same branch you saved it from; but having a clean working directory and applying it on the same branch aren’t necessary to successfully apply a stash. You can save a stash on one branch, switch to another branch later, and try to reapply the changes. You can also have modified and uncommitted files in your working directory when you apply a stash — Git gives you merge conflicts if anything no longer applies cleanly.</p>

<p>The changes to your files were reapplied, but the file you staged before wasn’t restaged. To do that, you must run the <code>git stash apply</code> command with a <code>--index</code> option to tell the command to try to reapply the staged changes. If you had run that instead, you’d have gotten back to your original position:</p>

<pre><code>$ git stash apply --index
# On branch master
# Changes to be committed:
#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)
#
#      modified:   index.html
#
# Changes not staged for commit:
#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
#
#      modified:   lib/simplegit.rb
#</code></pre>

<p>The apply option only tries to apply the stashed work — you continue to have it on your stack. To remove it, you can run <code>git stash drop</code> with the name of the stash to remove:</p>

<pre><code>$ git stash list
stash@{0}: WIP on master: 049d078 added the index file
stash@{1}: WIP on master: c264051 Revert &quot;added file_size&quot;
stash@{2}: WIP on master: 21d80a5 added number to log
$ git stash drop stash@{0}
Dropped stash@{0} (364e91f3f268f0900bc3ee613f9f733e82aaed43)</code></pre>

<p>You can also run <code>git stash pop</code> to apply the stash and then immediately drop it from your stack.</p>

<h3>Un-applying a Stash</h3>

<p>In some use case scenarios you might want to apply stashed changes, do some work, but then un-apply those changes that originally came from the stash. Git does not provide such a <code>stash unapply</code> command, but it is possible to achieve the effect by simply retrieving the patch associated with a stash and applying it in reverse:</p>

<pre><code>$ git stash show -p stash@{0} | git apply -R</code></pre>

<p>Again, if you don’t specify a stash, Git assumes the most recent stash:</p>

<pre><code>$ git stash show -p | git apply -R</code></pre>

<p>You may want to create an alias and effectively add a <code>stash-unapply</code> command to your Git. For example:</p>

<pre><code>$ git config --global alias.stash-unapply &#39;!git stash show -p | git apply -R&#39;
$ git stash apply
$ #... work work work
$ git stash-unapply</code></pre>

<h3>Creating a Branch from a Stash</h3>

<p>If you stash some work, leave it there for a while, and continue on the branch from which you stashed the work, you may have a problem reapplying the work. If the apply tries to modify a file that you’ve since modified, you’ll get a merge conflict and will have to try to resolve it. If you want an easier way to test the stashed changes again, you can run <code>git stash branch</code>, which creates a new branch for you, checks out the commit you were on when you stashed your work, reapplies your work there, and then drops the stash if it applies successfully:</p>

<pre><code>$ git stash branch testchanges
Switched to a new branch &quot;testchanges&quot;
# On branch testchanges
# Changes to be committed:
#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)
#
#      modified:   index.html
#
# Changes not staged for commit:
#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
#
#      modified:   lib/simplegit.rb
#
Dropped refs/stash@{0} (f0dfc4d5dc332d1cee34a634182e168c4efc3359)</code></pre>

<p>This is a nice shortcut to recover stashed work easily and work on it in a new branch.</p>

</div></div></div><div class="footer"><div class="pull-left"><span class="build-date">Build at: 2020-04-19 16:37:36</span>,<span class="build-source-version">Source revision:</span>,<span class="application-version">Application version: 0.0.7</span>.</div><div class="pull-right">Made by<a href="http://hackshen.com" target="_blank"> Hshen</a></div></div></div></div><script src="../../assets/vendor/jquery/dist/jquery.min.js"></script><script src="../../assets/vendor/jquery-pjax/jquery.pjax.js"></script><script src="../../assets/vendor/nprogress/nprogress.js"></script><script src="../../assets/vendor/bootstrap/dist/js/bootstrap.min.js"></script><script src="../../assets/js/main.js"></script></body></html>